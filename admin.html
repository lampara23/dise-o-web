<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - Doggy's</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            min-height: 100vh;
        }
        
        .nav-custom {
            background: rgba(11, 11, 25, 0.95) !important;
            border-bottom: 2px solid #00f5ff;
        }
        
        .admin-card {
            background: rgba(30, 30, 50, 0.8);
            border: 2px solid #00f5ff;
            border-radius: 15px;
            transition: all 0.3s ease;
        }
        
        .section-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
        }
        
        .form-control {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
        }
        
        .form-control:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: #00f5ff;
            color: white;
            box-shadow: 0 0 0 0.2rem rgba(0, 245, 255, 0.25);
        }
        
        .table-dark {
            background: rgba(30, 30, 50, 0.8);
        }
        
        .admin-badge {
            background: #ff4655;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .rarity-common { border-left: 4px solid #b0b0b0; }
        .rarity-rare { border-left: 4px solid #0070dd; }
        .rarity-epic { border-left: 4px solid #a335ee; }
        .rarity-legendary { border-left: 4px solid #ff8000; }
        
        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg nav-custom">
        <div class="container">
            <a class="navbar-brand text-white fw-bold" href="index.html">üå≠ DOGGY'S ADMIN</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link text-white mx-2" href="index.html">Inicio</a>
                <a class="nav-link text-white mx-2" href="cuenta.html">Mi Cuenta</a>
                <a class="nav-link text-white mx-2" onclick="logout()">Cerrar Sesi√≥n</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h1 class="text-center mb-4">üõ†Ô∏è Panel de Administraci√≥n</h1>
        
        <!-- Resumen General -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="admin-card p-3 text-center">
                    <h3 class="stats-number" id="totalProducts">0</h3>
                    <p>Productos</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="admin-card p-3 text-center">
                    <h3 class="stats-number" id="totalUsers">0</h3>
                    <p>Usuarios</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="admin-card p-3 text-center">
                    <h3 class="stats-number" id="totalOrders">0</h3>
                    <p>Pedidos</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="admin-card p-3 text-center">
                    <h3 class="stats-number" id="totalRevenue">$0</h3>
                    <p>Ingresos</p>
                </div>
            </div>
        </div>

        <!-- Gesti√≥n de Productos -->
        <div class="section-card p-4 mb-4">
            <h3>üì¶ Gesti√≥n de Productos</h3>
            
            <!-- Formulario para agregar/editar producto -->
            <div class="mb-4">
                <h5 id="formTitle">‚ûï Agregar Nuevo Producto</h5>
                <form id="productForm" onsubmit="saveProduct(event)">
                    <input type="hidden" id="productId">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Nombre del producto:</label>
                            <input type="text" class="form-control" id="productName" required>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="form-label">Precio:</label>
                            <input type="number" class="form-control" id="productPrice" min="0" required>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="form-label">Stock:</label>
                            <input type="number" class="form-control" id="productStock" min="0" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Descripci√≥n:</label>
                            <textarea class="form-control" id="productDescription" rows="2" required></textarea>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="form-label">Categor√≠a:</label>
                            <select class="form-control" id="productCategory" required>
                                <option value="completos">Completos</option>
                                <option value="hotdogs">Hot Dogs</option>
                                <option value="especiales">Especiales</option>
                                <option value="combos">Combos</option>
                            </select>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="form-label">Rareza:</label>
                            <select class="form-control" id="productRarity" required>
                                <option value="common">Com√∫n</option>
                                <option value="rare">Raro</option>
                                <option value="epic">√âpico</option>
                                <option value="legendary">Legendario</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="productLimited">
                                <label class="form-check-label" for="productLimited">
                                    Producto Limitado
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Imagen (emoji):</label>
                            <input type="text" class="form-control" id="productImage" value="üå≠">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary me-2" id="saveBtn">üíæ Guardar Producto</button>
                    <button type="button" class="btn btn-secondary" id="cancelBtn" style="display:none;" onclick="cancelEdit()">‚ùå Cancelar</button>
                </form>
            </div>
            
            <!-- Lista de productos -->
            <h5>üìã Lista de Productos</h5>
            <div class="table-responsive">
                <table class="table table-dark table-hover">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Precio</th>
                            <th>Stock</th>
                            <th>Categor√≠a</th>
                            <th>Rareza</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="productsTable">
                        <!-- Los productos se cargar√°n aqu√≠ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Gesti√≥n de Usuarios -->
        <div class="section-card p-4">
            <h3>üë• Usuarios Registrados</h3>
            <div class="table-responsive">
                <table class="table table-dark table-hover">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Email</th>
                            <th>Rol</th>
                        </tr>
                    </thead>
                    <tbody id="usersTable">
                        <!-- Los usuarios se cargar√°n aqu√≠ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let products = [];
        let users = [];

        // Verificar si es administrador
        document.addEventListener('DOMContentLoaded', function() {
            const user = JSON.parse(localStorage.getItem('doggyUser'));
            
            if (!user || user.email !== 'admin@doggys.cl') {
                alert('üîê Acceso denegado. No tienes permisos de administrador.');
                window.location.href = 'login.html';
                return;
            }
            
            // Cargar datos
            loadProducts();
            loadUsers();
            updateDashboard();
        });

        // Cargar productos desde API
        async function loadProducts() {
            try {
                const response = await fetch('http://localhost:8000/api/products');
                products = await response.json();
                displayProducts(products);
                updateDashboard();
            } catch (error) {
                console.error('Error cargando productos:', error);
            }
        }

        function displayProducts(products) {
            const productsTable = document.getElementById('productsTable');
            productsTable.innerHTML = products.map(product => `
                <tr class="rarity-${product.rarity}">
                    <td>${product.name}</td>
                    <td>$${product.price.toLocaleString()}</td>
                    <td>${product.stock}</td>
                    <td>${product.category}</td>
                    <td>
                        <span class="badge ${getRarityBadgeClass(product.rarity)}">
                            ${getRarityText(product.rarity)}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-warning me-1" onclick="editProduct('${product._id}')">‚úèÔ∏è Editar</button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteProduct('${product._id}')">üóëÔ∏è Eliminar</button>
                    </td>
                </tr>
            `).join('');
        }

        // Cargar usuarios desde API
        async function loadUsers() {
            try {
                const response = await fetch('http://localhost:8000/api/users');
                users = await response.json();
                displayUsers(users);
            } catch (error) {
                console.error('Error cargando usuarios:', error);
            }
        }

        function displayUsers(users) {
            const usersTable = document.getElementById('usersTable');
            usersTable.innerHTML = users.map(user => `
                <tr>
                    <td>${user._id}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>
                        <span class="badge ${user.role === 'admin' ? 'bg-danger' : 'bg-secondary'}">
                            ${user.role}
                        </span>
                    </td>
                </tr>
            `).join('');
        }

        // Actualizar dashboard
        function updateDashboard() {
            document.getElementById('totalProducts').textContent = products.length;
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalOrders').textContent = '0'; // Por implementar
            document.getElementById('totalRevenue').textContent = '$0'; // Por implementar
        }

        // Guardar producto (nuevo o editado)
        async function saveProduct(event) {
            event.preventDefault();
            
            const productData = {
                name: document.getElementById('productName').value,
                price: parseInt(document.getElementById('productPrice').value),
                stock: parseInt(document.getElementById('productStock').value),
                description: document.getElementById('productDescription').value,
                category: document.getElementById('productCategory').value,
                rarity: document.getElementById('productRarity').value,
                image: document.getElementById('productImage').value,
                type: document.getElementById('productCategory').value,
                limited: document.getElementById('productLimited').checked
            };
            
            const productId = document.getElementById('productId').value;
            const isEditing = productId !== '';
            
            try {
                if (isEditing) {
                    await updateProduct(productId, productData);
                } else {
                    await createProduct(productData);
                }
                
                loadProducts();
                resetForm();
            } catch (error) {
                console.error('Error guardando producto:', error);
                alert('‚ùå Error guardando producto');
            }
        }

        // Crear producto
        async function createProduct(productData) {
            const response = await fetch('http://localhost:8000/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(productData)
            });
            const result = await response.json();
            alert('‚úÖ Producto creado correctamente');
            return result;
        }

        // Actualizar producto
        async function updateProduct(productId, productData) {
            const response = await fetch(`http://localhost:8000/api/products/${productId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(productData)
            });
            const result = await response.json();
            alert('‚úÖ Producto actualizado correctamente');
            return result;
        }

        // Editar producto
        function editProduct(productId) {
            const product = products.find(p => p._id === productId);
            
            if (product) {
                document.getElementById('formTitle').textContent = '‚úèÔ∏è Editar Producto';
                document.getElementById('productId').value = product._id;
                document.getElementById('productName').value = product.name;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productStock').value = product.stock;
                document.getElementById('productDescription').value = product.description;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productRarity').value = product.rarity;
                document.getElementById('productImage').value = product.image;
                document.getElementById('productLimited').checked = product.limited || false;
                
                document.getElementById('saveBtn').textContent = 'üíæ Actualizar Producto';
                document.getElementById('cancelBtn').style.display = 'inline-block';
                
                document.getElementById('productForm').scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Eliminar producto
        async function deleteProduct(productId) {
            if (confirm('¬øEst√°s seguro de eliminar este producto?')) {
                try {
                    await fetch(`http://localhost:8000/api/products/${productId}`, {
                        method: 'DELETE'
                    });
                    alert('üóëÔ∏è Producto eliminado correctamente');
                    loadProducts();
                } catch (error) {
                    console.error('Error eliminando producto:', error);
                    alert('‚ùå Error eliminando producto');
                }
            }
        }

        // Cancelar edici√≥n
        function cancelEdit() {
            resetForm();
        }

        // Resetear formulario
        function resetForm() {
            document.getElementById('productForm').reset();
            document.getElementById('productId').value = '';
            document.getElementById('productImage').value = 'üå≠';
            document.getElementById('formTitle').textContent = '‚ûï Agregar Nuevo Producto';
            document.getElementById('saveBtn').textContent = 'üíæ Guardar Producto';
            document.getElementById('cancelBtn').style.display = 'none';
        }

        // Cerrar sesi√≥n
        function logout() {
            if (confirm('¬øEst√°s seguro de cerrar sesi√≥n?')) {
                localStorage.removeItem('doggyUser');
                window.location.href = 'login.html';
            }
        }

        // Funciones auxiliares
        function getRarityText(rarity) {
            const rarityTexts = {
                'common': 'Com√∫n',
                'rare': 'Raro',
                'epic': '√âpico',
                'legendary': 'Legendario'
            };
            return rarityTexts[rarity] || '';
        }

        function getRarityBadgeClass(rarity) {
            const badgeClasses = {
                'common': 'bg-secondary',
                'rare': 'bg-primary',
                'epic': 'bg-purple',
                'legendary': 'bg-warning'
            };
            return badgeClasses[rarity] || 'bg-secondary';
        }
    </script>
</body>
</html>